var EasyExclude=new Class({Implements:[Options],options:{table:""},fields:null,usergroup:0,checkboxes:{},initialize:function(b){var a=this;this.setOptions(b);$("easyExclude_usergroup").addEvent("change",function(){a.fields=$$("div.easyExclude");a.usergroup=this.get("value");if(a.usergroup>0){a.cleanTheScreen();a.addCheckboxes();a.updateStates()}else{a.cleanTheScreen()}});window.addEvent("subpalette",function(){$("easyExclude_usergroup").fireEvent("change")})},updateStates:function(){var a=this;new Request.JSON({url:window.location.href,data:"isAjax=1&action=easyExcludeGetFieldRights&usergroup="+this.usergroup+"&table="+this.options.table+"&REQUEST_TOKEN="+REQUEST_TOKEN,onRequest:function(){AjaxRequest.displayBox(CONTAO_LOADING+" …")},onComplete:function(){AjaxRequest.hideBox()},onFailure:function(){alert("failed")},onSuccess:function(b,c){if(b.content){b.content.each(function(d){var e="easyExclude_"+d+"_"+a.usergroup;if($(e)){$(e).checked=true}})}a.changeBackgroundColor()}}).send()},addCheckboxes:function(){var a=this;this.fields.each(function(c){var b="easyExclude_"+a.filterForFieldName(c.get("class"))+"_"+a.usergroup;var d=null;if(a.checkboxes[b]){d=a.checkboxes[b]}else{d=new Element("input",{type:"checkbox",name:b,id:b,"class":"tl_checkbox easyExcludeCheckbox",events:{change:function(){a.saveChange(c,this)}}})}d.inject(c,"top")})},saveChange:function(c,e){var a=this;var b=(e.checked)?1:0;var d=new Request.JSON({url:window.location.href,data:"isAjax=1&action=easyExcludeSaveChange&usergroup="+this.usergroup+"&field="+a.filterForFieldName(c.get("class"))+"&table="+this.options.table+"&state="+b+"&REQUEST_TOKEN="+REQUEST_TOKEN,onRequest:function(){AjaxRequest.displayBox(CONTAO_LOADING+" …")},onComplete:function(){AjaxRequest.hideBox()},onFailure:function(){alert("failed")},onSuccess:function(g,f){a.changeBackgroundColor()}}).send()},filterForFieldName:function(b){var a=/easyExcludeFN_([\S]+)/i.exec(b);return a[1]},changeBackgroundColor:function(){$$("input.easyExcludeCheckbox").each(function(b){var a=b.getParent("div.easyExclude");if(b.checked){a.setStyle("background","#E4FFD4")}else{a.setStyle("background","#EBEBEB")}})},cleanTheScreen:function(){$$("input.easyExcludeCheckbox").each(function(b){var a=b.get("id");this.checkboxes[a]=b.dispose()}.bind(this));this.fields.each(function(a){a.setStyle("background","")})}});