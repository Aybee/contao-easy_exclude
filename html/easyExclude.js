var needsRequestToken=window.Request.Contao?!0:!1;Request.Compatibility=new Class({Extends:needsRequestToken?Request.Contao:Request.Mixed,initialize:function(a){this.parent(a)},send:function(a){needsRequestToken&&(this.options.data+="&REQUEST_TOKEN="+REQUEST_TOKEN),this.parent(a)}});var EasyExclude=new Class({Implements:[Options],options:{table:""},fields:null,usergroup:0,checkboxes:{},initialize:function(a){var b=this;this.setOptions(a),$("easyExclude_usergroup").addEvent("change",function(){b.fields=$$("div.easyExclude"),b.usergroup=this.get("value"),b.usergroup>0?(b.cleanTheScreen(),b.addCheckboxes(),b.updateStates()):b.cleanTheScreen()}),window.addEvent("subpalette",function(){$("easyExclude_usergroup").fireEvent("change")})},updateStates:function(){var a=this;(new Request.Compatibility({url:window.location.href,data:"isAjax=1&action=easyExcludeGetFieldRights&usergroup="+this.usergroup+"&table="+this.options.table,onRequest:function(){AjaxRequest.displayBox("Loading data \u2026")},onComplete:function(){AjaxRequest.hideBox()},onFailure:function(){alert("failed")},onSuccess:function(b,c){if(b){var d=JSON.decode(b);b=d?d:b,b.each(function(b){var c="easyExclude_"+b+"_"+a.usergroup;$(c)&&($(c).checked=!0)})}a.changeBackgroundColor()}})).send()},addCheckboxes:function(){var a=this;this.fields.each(function(b){var c="easyExclude_"+a.filterForFieldName(b.get("class"))+"_"+a.usergroup,d=null;a.checkboxes[c]?d=a.checkboxes[c]:d=new Element("input",{type:"checkbox",name:c,id:c,"class":"tl_checkbox easyExcludeCheckbox",events:{change:function(){a.saveChange(b,this)}}}),d.inject(b,"top")})},saveChange:function(a,b){var c=this,d=b.checked?1:0,e=(new Request.Compatibility({url:window.location.href,data:"isAjax=1&action=easyExcludeSaveChange&usergroup="+this.usergroup+"&field="+c.filterForFieldName(a.get("class"))+"&table="+this.options.table+"&state="+d,onRequest:function(){AjaxRequest.displayBox("Loading data \u2026")},onComplete:function(){AjaxRequest.hideBox()},onFailure:function(){alert("failed")},onSuccess:function(a,b){c.changeBackgroundColor()}})).send()},filterForFieldName:function(a){var b=/easyExcludeFN_([\S]+)/i.exec(a);return b[1]},changeBackgroundColor:function(){$$("input.easyExcludeCheckbox").each(function(a){var b=a.getParent("div.easyExclude");a.checked?b.setStyle("background","#E4FFD4"):b.setStyle("background","#EBEBEB")})},cleanTheScreen:function(){$$("input.easyExcludeCheckbox").each(function(a){var b=a.get("id");this.checkboxes[b]=a.dispose()}.bind(this)),this.fields.each(function(a){a.setStyle("background","")})}})